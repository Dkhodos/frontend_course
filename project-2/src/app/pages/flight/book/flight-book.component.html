<page title="Book a Flight">
  <div class="book-a-flight-loader" *ngIf="isLoading(); else book_a_flight">
    <ono-flight-loader></ono-flight-loader>
  </div>

  <ng-template #book_a_flight>
    <ng-container *ngIf="flight(); else notFound">
      <app-flight-information [flight]="flight()!" />

      <!-- Wrap stepper inside a form so ControlContainer is provided -->
      <form [formGroup]="form">
        <mat-horizontal-stepper linear #stepper>
          <!-- Step 1: Passengers -->
          <mat-step [stepControl]="form.controls.passengers">
            <ng-template matStepLabel>Passengers</ng-template>
            <app-passenger-step
              [passengers]="form.controls.passengers"
              [stepper]="stepper"
            />
          </mat-step>

          <!-- Step 2: Baggage -->
          <mat-step>
            <ng-template matStepLabel>Baggage</ng-template>
            <app-baggage-step [stepper]="stepper"></app-baggage-step>
          </mat-step>

          <!-- Step 3: Seats -->
          <mat-step>
            <ng-template matStepLabel>Seats</ng-template>
            <app-seats-step
              [stepper]="stepper"
              [flight]="flight()!"
              [passengers]="passengersState"
              [seatsControl]="form.controls.seats"
            />
          </mat-step>

          <!-- Step 4: Summary -->
          <mat-step>
            <ng-template matStepLabel>Summary</ng-template>
            <app-summary-step
              [stepper]="stepper"
              [flight]="flight()!"
              [passengers]="passengersState"
              [seatSummaryItems]="seatSummary"
              (book)="onBook()"
            ></app-summary-step>
          </mat-step>
        </mat-horizontal-stepper>
      </form>
    </ng-container>

    <!-- Not Found Fallback -->
    <ng-template #notFound>
      <ono-not-found-placeholder
        title="Flight Not Found"
        description="We could not find the flight details. Please check the flight ID and try again."
      ></ono-not-found-placeholder>
    </ng-template>
  </ng-template>
</page>
